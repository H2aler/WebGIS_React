<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>거리 측정 간단 테스트</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #map {
            width: 100%;
            height: 400px;
            border: 2px solid #ccc;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #result {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>거리 측정 간단 테스트</h1>
    <button id="measureBtn">거리 측정 시작</button>
    <button id="clearBtn">모두 지우기</button>
    <div id="map"></div>
    <div id="result">버튼을 클릭하고 지도에서 두 지점을 클릭하세요.</div>

    <script type="module">
        import 'ol/ol.css';
        import Map from 'ol/Map';
        import View from 'ol/View';
        import TileLayer from 'ol/layer/Tile';
        import VectorLayer from 'ol/layer/Vector';
        import VectorSource from 'ol/source/Vector';
        import OSM from 'ol/source/OSM';
        import { fromLonLat } from 'ol/proj';
        import { Draw } from 'ol/interaction';
        import { getLength } from 'ol/sphere';
        import { Style, Stroke, Fill, Circle as CircleStyle } from 'ol/style';

        console.log('스크립트 시작');

        // 지도 생성
        const map = new Map({
            target: 'map',
            layers: [
                new TileLayer({
                    source: new OSM()
                })
            ],
            view: new View({
                center: fromLonLat([127.7669, 37.5665]), // 서울
                zoom: 10
            })
        });

        console.log('지도 생성 완료');

        // 벡터 소스와 레이어
        const vectorSource = new VectorSource();
        const vectorLayer = new VectorLayer({
            source: vectorSource,
            style: new Style({
                stroke: new Stroke({
                    color: '#ff0000',
                    width: 3
                }),
                image: new CircleStyle({
                    radius: 6,
                    fill: new Fill({
                        color: '#ff0000'
                    })
                })
            })
        });

        map.addLayer(vectorLayer);
        console.log('벡터 레이어 추가 완료');

        let draw = null;

        // 거리 측정 시작
        document.getElementById('measureBtn').addEventListener('click', () => {
            console.log('거리 측정 버튼 클릭됨');
            
            // 기존 인터랙션 제거
            if (draw) {
                map.removeInteraction(draw);
                console.log('기존 인터랙션 제거됨');
            }

            // 새로운 Draw 인터랙션 생성
            draw = new Draw({
                source: vectorSource,
                type: 'LineString'
            });

            console.log('Draw 인터랙션 생성됨');

            // 그리기 완료 이벤트
            draw.on('drawend', (event) => {
                console.log('그리기 완료됨');
                const feature = event.feature;
                const geometry = feature.getGeometry();
                const coordinates = geometry.getCoordinates();
                
                console.log('좌표:', coordinates);
                console.log('좌표 개수:', coordinates.length);
                
                if (coordinates.length >= 2) {
                    const length = getLength(geometry);
                    console.log('계산된 거리:', length);
                    
                    const resultText = length < 1000 ? 
                        `거리: ${length.toFixed(1)} m` : 
                        `거리: ${(length / 1000).toFixed(3)} km`;
                    
                    document.getElementById('result').innerHTML = 
                        `<span style="color: green;">✅ ${resultText}</span>`;
                    
                    console.log('결과 표시됨:', resultText);
                } else {
                    document.getElementById('result').innerHTML = 
                        '<span style="color: red;">❌ 두 개 이상의 지점이 필요합니다.</span>';
                }
            });

            // 인터랙션을 지도에 추가
            map.addInteraction(draw);
            document.getElementById('result').innerHTML = 
                '<span style="color: blue;">지도에서 두 지점을 클릭하여 거리를 측정하세요.</span>';
            
            console.log('인터랙션 지도에 추가됨');
        });

        // 모두 지우기
        document.getElementById('clearBtn').addEventListener('click', () => {
            vectorSource.clear();
            document.getElementById('result').innerHTML = '모든 데이터가 삭제되었습니다.';
            console.log('모든 데이터 삭제됨');
        });

        console.log('이벤트 리스너 설정 완료');
    </script>
</body>
</html> 